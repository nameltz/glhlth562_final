---
title: "Visualizing Student Debt:"
subtitle: "Student Loans, State Spending, and Tuition" 
author: 
  - Natalie Meltzer
date: '`r Sys.Date()`'
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    nature:
      slideNumberFormat: "%current%"
      highlightStyle: github
      highlightLines: true
      ratio: 16:9
      countIncrementalSlides: true
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  fig.width=9, fig.height=3.5, fig.retina=3,
  out.width = "100%",
  cache = FALSE,
  echo = TRUE,
  message = FALSE, 
  warning = FALSE,
  hiline = TRUE
)

```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
library(sysfonts)
style_mono_light(base_color = "#23395b",
  header_font_google = google_font("Inter", "600"),
  text_font_google   = google_font("Inter", "300", "300i"),
  code_font_google   = google_font("Inter"))
  
```

```{r data, include=FALSE, warning=FALSE}
library(tidyverse)
library(readxl)
library(janitor)
library(dataReporter)
library(patchwork)
library(usdata)
library(maps)
library(ggplot2)
  

# read in data with multiple sheets 
# code from https://stackoverflow.com/questions/49359587/import-excel-workbook-with-multiple-sheets

path <- "../data/household_debt.xlsx"
sheetnames <- excel_sheets(path)
debtlevels <- lapply(excel_sheets(path), read_excel, path = path)
names(debtlevels) <- sheetnames

studentdebt <- lapply(excel_sheets(path), read_excel, path = path)
names(debtlevels) <- sheetnames

path2 <- "../data/state_spending.xls"
sheetnames <- excel_sheets(path2)
statespending <- lapply(excel_sheets(path2), read_excel, path = path2)
names(statespending) <- sheetnames


# read in other data 


studentdebt <- read_excel("../data/totaldebtbalance.xlsx") %>%
  select(c("Year", "Student Loan"))%>%
  clean_names() %>%
  filter(grepl("Q4", year))%>%
  mutate("year" = str_sub(year, 1,2)) %>%
  mutate("year" = str_glue("20{year}"))%>%
    mutate("year" = as.numeric(year)) %>%
   mutate("studentloan_adj" = case_when (
    year == 2004 ~ student_loan * 1.35,
     year == 2005 ~ student_loan * 1.31,
     year == 2006 ~ student_loan * 1.27,
     year == 2007 ~ student_loan * 1.22,
     year == 2008 ~ student_loan * 1.22,
     year == 2009 ~ student_loan * 1.19,
     year == 2010 ~ student_loan * 1.17,
     year == 2011 ~ student_loan * 1.14,
     year == 2012 ~ student_loan * 1.12,
     year == 2013 ~ student_loan * 1.1,
     year == 2014 ~ student_loan * 1.09,
     year == 2015 ~ student_loan * 1.09,
     year == 2016 ~ student_loan * 1.06,
     year == 2017 ~ student_loan * 1.04,
     year == 2018 ~ student_loan * 1.02,
     year == 2019 ~ student_loan * 1))%>%
  filter(!is.na(studentloan_adj))%>%
  mutate("studentloan_adj" = 1000*studentloan_adj)

  

educationcosts <- read_excel("../data/education_costs.xls") %>% 
  clean_names() %>%
 mutate("year" = str_sub(year, 1,4))

# clean data
## convert lists to tibble, drop unnecessary columns, filter unnecessary rows



debtlevels <- enframe(debtlevels) %>% 
  select(name, value) %>%
  unnest_wider(value) %>%
  select(!ends_with(c("_2003", "_2020","_2021"))) %>%
  rename("debt_type" = name)



debtlevels  <- debtlevels %>% unnest(cols = c(state:Q4_2019))%>%
  filter(debt_type != "total") %>%
  filter(state != "allUS") %>%
   pivot_longer(!debt_type:state, names_to = "year", values_to = "amount") %>%
  pivot_wider(names_from = debt_type, values_from = amount)%>%
   mutate(year = str_remove(year, "Q4_")) %>%
  select(c("state", "year", "studentloan", "studentloan_delinq"))
  

statespending <- enframe(statespending, name = "year") %>%
  select(year, value) %>%
  unnest_longer(value) %>%
  unnest(cols = "value") %>% 
  clean_names() %>%
  select(c("state", "year", "higher_education"))

## merge datasets 

debtspending <- debtlevels %>%
  mutate(state = abbr2state(state)) %>%
  right_join(statespending, by = c("state", "year")) 


## adjust for inflation - multipliers from BLS

debtspending <- debtspending %>% 
  mutate("studentloan_adj" = case_when (
    year == 2004 ~ studentloan * 1.35,
     year == 2005 ~ studentloan * 1.31,
     year == 2006 ~ studentloan * 1.27,
     year == 2007 ~ studentloan * 1.22,
     year == 2008 ~ studentloan * 1.22,
     year == 2009 ~ studentloan * 1.19,
     year == 2010 ~ studentloan * 1.17,
     year == 2011 ~ studentloan * 1.14,
     year == 2012 ~ studentloan * 1.12,
     year == 2013 ~ studentloan * 1.1,
     year == 2014 ~ studentloan * 1.09,
     year == 2015 ~ studentloan * 1.09,
     year == 2016 ~ studentloan * 1.06,
     year == 2017 ~ studentloan * 1.04,
     year == 2018 ~ studentloan * 1.02,
     year == 2019 ~ studentloan * 1)) %>%
  mutate("highered_adj" = case_when (
    year == 2004 ~ higher_education * 1.35,
     year == 2005 ~ higher_education * 1.31,
     year == 2006 ~ higher_education * 1.27,
     year == 2007 ~ higher_education * 1.22,
     year == 2008 ~ higher_education * 1.22,
     year == 2009 ~ higher_education * 1.19,
     year == 2010 ~ higher_education * 1.17,
     year == 2011 ~ higher_education * 1.14,
     year == 2012 ~ higher_education * 1.12,
     year == 2013 ~ higher_education * 1.1,
     year == 2014 ~ higher_education * 1.09,
     year == 2015 ~ higher_education * 1.09,
     year == 2016 ~ higher_education * 1.06,
     year == 2017 ~ higher_education * 1.04,
     year == 2018 ~ higher_education * 1.02,
     year == 2019 ~ higher_education * 1)) %>%
  select(-c("studentloan", "higher_education"))
   

debtspending <- debtspending %>%
  group_by(state) %>%
  mutate(loan_pct_chg = 100 *((studentloan_adj-lag(studentloan_adj))/lag(studentloan_adj))) %>%
   mutate(spend_pct_chg = 100 *((highered_adj-lag(highered_adj))/lag(highered_adj)))

statemap <- map_data("state") %>%
  mutate(state = str_to_title(region, locale = "en"))
  
debtspending <- debtspending %>%
  left_join(statemap, by = "state") %>%
  filter(!is.na(long))
```


# **How many of you have student loans?**
--

### 42 million Americans -- about one in every eight -- have student loans

--

### 75% of student loan borrowers took our loans to go to two- or four-year colleges

--

### 25% of student loan borrowers took out loans for grad school


.footnote[Adam Looney, David Wessel, and Kadija Yilla, Brookings Institute]
---

# Was it always this way? 

```{r echo = FALSE}
ggplot(studentdebt, aes(x = year, 
            y = studentloan_adj))+
  geom_line()+
  scale_y_continuous(labels = scales::dollar_format())+
  theme_minimal()+
    theme_xaringan(background_color = "#FFFFFF") +
  scale_xaringan_fill_discrete()+
  theme(plot.title.position = "plot",
        plot.title = element_text(size=20,
                                  face="bold"),
        plot.subtitle = element_text(size=15),
        plot.caption = element_text(size=10))+
  labs(title = "Total student loan burden",
       subtitle = "Dollars outstanding (in billions, $2019)",
       caption = "Data: Federal Reserve Bank of New York, Quarterly Report on Household Debt and Credit",
       x = "",
       y = "")

```

---

name: colors

## Colors

.left-column[
Text color

[Link Color](#3)

**Bold Color**

_Italic Color_

`Inline Code`
]

.right-column[
Lorem ipsum dolor sit amet, [consectetur adipiscing elit (link)](#3), 
sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. 
Erat nam at lectus urna.
Pellentesque elit ullamcorper **dignissim cras tincidunt (bold)** lobortis feugiat. 
_Eros donec ac odio tempor_ orci dapibus ultrices. 
Id porta nibh venenatis cras sed felis eget velit aliquet.
Aliquam id diam maecenas ultricies mi.
Enim sit amet 
`code_color("inline")`
venenatis urna cursus eget nunc scelerisque viverra.
]

---

# Big Topic or Inverse Slides `#`

## Slide Headings `##`

### Sub-slide Headings `###`

#### Bold Call-Out `####`

This is a normal paragraph text. Only use header levels 1-4.

##### Possible, but not recommended `#####`

###### Definitely don't use h6 `######`

---

# Left-Column Headings

.left-column[
## First

## Second

## Third
]

.right-column[
Dolor quis aptent mus a dictum ultricies egestas.

Amet egestas neque tempor fermentum proin massa!

Dolor elementum fermentum pharetra lectus arcu pulvinar.
]

---
class: inverse center middle

# Topic Changing Interstitial

--

```
class: inverse center middle
```

---
layout: true

## Blocks

---

### Blockquote

> This is a blockquote following a header.
>
> When something is important enough, you do it even if the odds are not in your favor.

---

### Code Blocks

#### R Code

```{r eval=FALSE}
ggplot(gapminder) +
  aes(x = gdpPercap, y = lifeExp, size = pop, color = country) +
  geom_point() +
  facet_wrap(~year)
```

#### JavaScript

```js
var fun = function lang(l) {
  dateformat.i18n = require('./lang/' + l)
  return true;
}
```

---

### More R Code

```{r eval=FALSE}
dplyr::starwars %>% dplyr::slice_sample(n = 4)
```

---

```{r message=TRUE, eval=requireNamespace("cli", quietly = TRUE)}
cli::cli_alert_success("It worked!")
```

--

```{r message=TRUE}
message("Just a friendly message")
```

--

```{r warning=TRUE}
warning("This could be bad...")
```

--

```{r error=TRUE}
stop("I hope you're sitting down for this")
```


---
layout: true

## Tables

---
exclude: `r if (requireNamespace("tibble", quietly=TRUE)) "false" else "true"`

```{r eval=requireNamespace("tibble", quietly=TRUE)}
tibble::as_tibble(mtcars)
```

---

```{r}
knitr::kable(head(mtcars), format = 'html')
```

---
exclude: `r if (requireNamespace("DT", quietly=TRUE)) "false" else "true"`

```{r eval=requireNamespace("DT", quietly=TRUE)}
DT::datatable(head(mtcars), fillContainer = FALSE, options = list(pageLength = 4))
```

---
layout: true

## Lists

---

.pull-left[
#### Here is an unordered list:

*   Item foo
*   Item bar
*   Item baz
*   Item zip
]

.pull-right[

#### And an ordered list:

1.  Item one
1.  Item two
1.  Item three
1.  Item four
]

---

### And a nested list:

- level 1 item
  - level 2 item
  - level 2 item
    - level 3 item
    - level 3 item
- level 1 item
  - level 2 item
  - level 2 item
  - level 2 item
- level 1 item
  - level 2 item
  - level 2 item
- level 1 item

---

### Nesting an ol in ul in an ol

- level 1 item (ul)
  1. level 2 item (ol)
  1. level 2 item (ol)
    - level 3 item (ul)
    - level 3 item (ul)
- level 1 item (ul)
  1. level 2 item (ol)
  1. level 2 item (ol)
    - level 3 item (ul)
    - level 3 item (ul)
  1. level 4 item (ol)
  1. level 4 item (ol)
    - level 3 item (ul)
    - level 3 item (ul)
- level 1 item (ul)

---
layout: true

## Plots

---

```{r plot-example, eval=requireNamespace("ggplot2", quietly=TRUE)}
library(ggplot2)
(g <- ggplot(mpg) + aes(hwy, cty, color = class) + geom_point())
```

---

```{r plot-example-themed, eval=requireNamespace("showtext", quietly=TRUE) && requireNamespace("ggplot2", quietly=TRUE)}
g + xaringanthemer::theme_xaringan(text_font_size = 16, title_font_size = 18) +
  ggtitle("A Plot About Cars")
```

.footnote[Requires `{showtext}`]

---
layout: false

## Square image

<center><img src="https://octodex.github.com/images/labtocat.png" alt="GithHub Octocat" height="400px" /></center>

.footnote[GitHub Octocat]

---

### Wide image

![A wide image with a diagram of branching in git.](https://docs.github.com/assets/images/help/repository/branching.png)

.footnote[Wide images scale to 100% slide width]

---

## Two images

.pull-left[
![A GitHub Octocat, style "mother hubber"](https://octodex.github.com/images/motherhubbertocat.png)
]

.pull-right[
![A GitHub Octocat, style "dinotcat"](https://octodex.github.com/images/dinotocat.png)
]

---

### Definition lists can be used with HTML syntax.

<dl>
<dt>Name</dt>
<dd>Godzilla</dd>
<dt>Born</dt>
<dd>1952</dd>
<dt>Birthplace</dt>
<dd>Japan</dd>
<dt>Color</dt>
<dd>Green</dd>
</dl>

---
class: center, middle

# Thanks!

Slides created via the R packages:

[**xaringan**](https://github.com/yihui/xaringan)<br>
[gadenbuie/xaringanthemer](https://github.com/gadenbuie/xaringanthemer)

The chakra comes from [remark.js](https://remarkjs.com), [**knitr**](http://yihui.name/knitr), and [R Markdown](https://rmarkdown.rstudio.com).
